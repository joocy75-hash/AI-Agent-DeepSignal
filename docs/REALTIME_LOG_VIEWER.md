# ì‹¤ì‹œê°„ ë¡œê·¸ ë·°ì–´ êµ¬í˜„ ê°€ì´ë“œ

## ê°œìš”
ë´‡ ì‹¤í–‰ ì¤‘ ë°±ì—”ë“œì—ì„œ ì¶œë ¥ë˜ëŠ” ëª¨ë“  ë¡œê·¸ë¥¼ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

## êµ¬í˜„ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        WebSocket        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Bot Runner    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Frontend UI     â”‚
â”‚  (bot_runner.py)â”‚                          â”‚  (BotLogViewer)  â”‚
â”‚                 â”‚                          â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Logger   â”‚  â”‚    LogBroadcastHandler   â”‚  â”‚ ì‹¤ì‹œê°„ ë¡œê·¸ â”‚  â”‚
â”‚  â”‚           â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  â”‚   ë·°ì–´     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                          â”‚                  â”‚
â”‚  - AI ì‹ í˜¸ ìƒì„± â”‚                          â”‚  - ë¡œê·¸ í‘œì‹œ    â”‚
â”‚  - ê±°ë˜ ì§„ì…    â”‚                          â”‚  - ì¼ì‹œì •ì§€     â”‚
â”‚  - ì—ëŸ¬ ë©”ì‹œì§€  â”‚                          â”‚  - ë‹¤ìš´ë¡œë“œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë°±ì—”ë“œ êµ¬í˜„

### 1. LogBroadcastHandler ([log_broadcaster.py](../backend/src/utils/log_broadcaster.py))

ì»¤ìŠ¤í…€ ë¡œê·¸ í•¸ë“¤ëŸ¬ë¡œ Python logging ì‹œìŠ¤í…œê³¼ í†µí•©ë©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
- ë¡œê·¸ ë ˆì½”ë“œë¥¼ WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì „ì†¡
- ìµœê·¼ 500ê°œ ë¡œê·¸ë¥¼ ë©”ëª¨ë¦¬ì— ë²„í¼ë§
- ì‚¬ìš©ìë³„ë¡œ ë¡œê·¸ í•¸ë“¤ëŸ¬ ë¶„ë¦¬ (ë©€í‹° ìœ ì € ì§€ì›)

**ì‚¬ìš© ì˜ˆì‹œ:**
```python
from utils.log_broadcaster import attach_log_handler, get_recent_logs

# ë´‡ ì‹œì‘ ì‹œ
attach_log_handler(user_id)

# ìµœê·¼ ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°
logs = get_recent_logs(user_id, limit=100)

# ë´‡ ì¤‘ì§€ ì‹œ
detach_log_handler(user_id)
```

### 2. BotManager í†µí•© ([manager.py](../backend/src/workers/manager.py))

ë´‡ ì‹œì‘/ì¤‘ì§€ ì‹œ ìë™ìœ¼ë¡œ ë¡œê·¸ í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€/ì œê±°í•©ë‹ˆë‹¤.

```python
async def start_bot(self, user_id: int):
    # ë¡œê·¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
    from ..utils.log_broadcaster import attach_log_handler
    attach_log_handler(user_id)

    await self.runner.start(self.session_factory, user_id)

async def stop_bot(self, user_id: int):
    # ë¡œê·¸ í•¸ë“¤ëŸ¬ ì œê±°
    from ..utils.log_broadcaster import detach_log_handler
    detach_log_handler(user_id)

    self.runner.stop(user_id)
```

### 3. WebSocket ì—”ë“œí¬ì¸íŠ¸ ([ws_server.py](../backend/src/websockets/ws_server.py))

í´ë¼ì´ì–¸íŠ¸ì˜ `get_recent_logs` ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

**ìš”ì²­:**
```json
{
  "action": "get_recent_logs",
  "limit": 100
}
```

**ì‘ë‹µ:**
```json
{
  "type": "recent_logs",
  "logs": [
    {
      "timestamp": "2025-12-10T05:20:30.123456",
      "level": "INFO",
      "logger": "backend.src.services.bot_runner",
      "message": "ğŸ”„ Processing market data: BTCUSDT @ $92,534.00",
      "module": "bot_runner",
      "function": "_run_loop",
      "line": 487
    }
  ],
  "timestamp": "2025-12-10T05:20:31Z"
}
```

**ì‹¤ì‹œê°„ ë¡œê·¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸:**
```json
{
  "type": "bot_log",
  "data": {
    "timestamp": "2025-12-10T05:20:30.123456",
    "level": "INFO",
    "message": "Strategy signal for user 1: hold"
  }
}
```

## í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### BotLogViewer ì»´í¬ë„ŒíŠ¸ ([BotLogViewer.jsx](../frontend/src/components/BotLogViewer.jsx))

**ì£¼ìš” ê¸°ëŠ¥:**

1. **ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°**
   - WebSocketì„ í†µí•´ ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì‹ 
   - ìµœëŒ€ 500ê°œê¹Œì§€ ë©”ëª¨ë¦¬ì— ìœ ì§€

2. **ì¼ì‹œì •ì§€/ì¬ê°œ**
   - ë¡œê·¸ê°€ ë„ˆë¬´ ë¹ ë¥´ê²Œ íë¥¼ ë•Œ ì¼ì‹œì •ì§€
   - ë²„í¼ì— ë¡œê·¸ë¥¼ ì €ì¥í–ˆë‹¤ê°€ ì¬ê°œ ì‹œ í•œ ë²ˆì— í‘œì‹œ

3. **ìë™ ìŠ¤í¬ë¡¤**
   - ìƒˆ ë¡œê·¸ê°€ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤
   - ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤í•˜ë©´ ìë™ ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™” ê°€ëŠ¥

4. **ë¡œê·¸ ë ˆë²¨ë³„ ìƒ‰ìƒ**
   - DEBUG: íšŒìƒ‰
   - INFO: íŒŒë‘
   - WARNING: ì£¼í™©
   - ERROR: ë¹¨ê°•
   - CRITICAL: ì§„í•œ ë¹¨ê°•

5. **ë¡œê·¸ ë‹¤ìš´ë¡œë“œ**
   - .txt íŒŒì¼ë¡œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸°
   - íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨

**ì‚¬ìš© ì˜ˆì‹œ:**
```jsx
import BotLogViewer from '../components/BotLogViewer';

<BotLogViewer
  height={400}      // ë¡œê·¸ ë·°ì–´ ë†’ì´ (px)
  maxLogs={500}     // ìµœëŒ€ ë¡œê·¸ ê°œìˆ˜
/>
```

### Trading í˜ì´ì§€ í†µí•© ([Trading.jsx](../frontend/src/pages/Trading.jsx))

ë´‡ì´ ì‹¤í–‰ ì¤‘ì¼ ë•Œë§Œ ë¡œê·¸ ë·°ì–´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

```jsx
{/* Bot Log Viewer - ë´‡ ì‹¤í–‰ ì¤‘ì¼ ë•Œë§Œ í‘œì‹œ */}
{isRunning && (
    <div style={{ marginTop: 20 }}>
        <BotLogViewer height={isMobile ? 300 : 400} maxLogs={500} />
    </div>
)}
```

## ì‚¬ìš© ë°©ë²•

### 1. ì›¹ UIì—ì„œ í™•ì¸

1. http://158.247.245.197:3000 ì ‘ì†
2. ë¡œê·¸ì¸ (admin@admin.com)
3. **íŠ¸ë ˆì´ë”©** í˜ì´ì§€ë¡œ ì´ë™
4. ì „ëµ ì„ íƒ í›„ **ë´‡ ì‹œì‘**
5. í™”ë©´ í•˜ë‹¨ì— **"ì‹¤ì‹œê°„ ë´‡ ë¡œê·¸"** ì¹´ë“œê°€ í‘œì‹œë¨
6. ë¡œê·¸ì—ì„œ ë‹¤ìŒ ë‚´ìš© í™•ì¸:
   - ğŸ”„ ì‹œì¥ ë°ì´í„° ì²˜ë¦¬
   - ğŸ” AI ì‹ í˜¸ ìƒì„±
   - ğŸ’° ì”ê³  ì¡°íšŒ
   - âš ï¸ ê²½ê³  ë©”ì‹œì§€
   - âŒ ì—ëŸ¬ ë©”ì‹œì§€

### 2. ë¡œê·¸ ë·°ì–´ ì»¨íŠ¸ë¡¤

- **ì¼ì‹œì •ì§€/ì¬ê°œ**: ë¡œê·¸ íë¦„ì„ ë©ˆì¶”ê³  ì²œì²œíˆ í™•ì¸
- **ìë™ ìŠ¤í¬ë¡¤**: ìƒˆ ë¡œê·¸ê°€ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
- **í´ë¦¬ì–´**: í˜„ì¬ í‘œì‹œëœ ëª¨ë“  ë¡œê·¸ ì‚­ì œ
- **ë‹¤ìš´ë¡œë“œ**: ë¡œê·¸ë¥¼ .txt íŒŒì¼ë¡œ ì €ì¥

## ë””ë²„ê¹… ê°€ì´ë“œ

### ë¬¸ì œ: ë¡œê·¸ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**í™•ì¸ ì‚¬í•­:**
1. WebSocket ì—°ê²° í™•ì¸
   - ê°œë°œì ë„êµ¬ (F12) â†’ Console
   - "WebSocket connected successfully" ë©”ì‹œì§€ í™•ì¸

2. ë´‡ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
   - ë´‡ ìƒíƒœê°€ "ì‹¤í–‰ ì¤‘"ì´ì–´ì•¼ í•¨

3. ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
   ```bash
   docker compose logs backend --tail 50
   ```

### ë¬¸ì œ: ë¡œê·¸ê°€ ë„ˆë¬´ ë¹ ë¥´ê²Œ íë¦„

**í•´ê²° ë°©ë²•:**
1. "ì¼ì‹œì •ì§€" ë²„íŠ¼ í´ë¦­
2. ë¡œê·¸ë¥¼ ì²œì²œíˆ í™•ì¸
3. í•„ìš” ì‹œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ í…ìŠ¤íŠ¸ ì—ë””í„°ì—ì„œ í™•ì¸

### ë¬¸ì œ: ë¡œê·¸ê°€ ì¤‘ë³µìœ¼ë¡œ í‘œì‹œë¨

**ì›ì¸:**
- ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì‹œì— ì ‘ì† ì¤‘

**í•´ê²° ë°©ë²•:**
- í•œ íƒ­ë§Œ ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ ë‹«ê¸°

## ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ë¦¬ ê´€ë¦¬
- ìµœëŒ€ 500ê°œ ë¡œê·¸ë§Œ ë©”ëª¨ë¦¬ì— ìœ ì§€
- ì˜¤ë˜ëœ ë¡œê·¸ëŠ” ìë™ìœ¼ë¡œ ì‚­ì œë¨
- í•„ìš” ì‹œ `maxLogs` propìœ¼ë¡œ ì¡°ì • ê°€ëŠ¥

### ë„¤íŠ¸ì›Œí¬ ìµœì í™”
- WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ì „ì†¡ (HTTP í´ë§ë³´ë‹¤ íš¨ìœ¨ì )
- ë¡œê·¸ ë ˆë²¨ë³„ í•„í„°ë§ ì§€ì› (í–¥í›„ í™•ì¥)

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ë¡œê·¸ ë ˆë²¨ í•„í„°ë§
```jsx
// ì˜ˆì‹œ: INFO ì´ìƒë§Œ í‘œì‹œ
<BotLogViewer minLevel="INFO" />
```

### 2. ë¡œê·¸ ê²€ìƒ‰
```jsx
// ì˜ˆì‹œ: "error" í‚¤ì›Œë“œ ê²€ìƒ‰
<BotLogViewer searchKeyword="error" />
```

### 3. ë¡œê·¸ ì˜êµ¬ ì €ì¥
- ë°ì´í„°ë² ì´ìŠ¤ì— ë¡œê·¸ ì €ì¥
- ê³¼ê±° ë¡œê·¸ ì¡°íšŒ ê¸°ëŠ¥

### 4. ë¡œê·¸ í†µê³„
- ì—ëŸ¬ ë°œìƒ íšŸìˆ˜
- ê±°ë˜ ì‹ í˜¸ í†µê³„

## ê´€ë ¨ íŒŒì¼

### ë°±ì—”ë“œ
- [backend/src/utils/log_broadcaster.py](../backend/src/utils/log_broadcaster.py) - ë¡œê·¸ ë¸Œë¡œë“œìºìŠ¤í„°
- [backend/src/workers/manager.py](../backend/src/workers/manager.py) - BotManager í†µí•©
- [backend/src/websockets/ws_server.py](../backend/src/websockets/ws_server.py) - WebSocket ì„œë²„

### í”„ë¡ íŠ¸ì—”ë“œ
- [frontend/src/components/BotLogViewer.jsx](../frontend/src/components/BotLogViewer.jsx) - ë¡œê·¸ ë·°ì–´ ì»´í¬ë„ŒíŠ¸
- [frontend/src/pages/Trading.jsx](../frontend/src/pages/Trading.jsx) - íŠ¸ë ˆì´ë”© í˜ì´ì§€ í†µí•©

## ë¼ì´ì„ ìŠ¤
MIT
